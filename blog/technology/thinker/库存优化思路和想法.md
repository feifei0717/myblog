[TOC]



# 扣库存总结

## 扣库存方式:

- 在扣库存事务开始前先建议校验:比如商品存在.等等
- 对于mysql应该先扣库存在查询数据校验,超卖然后在回滚.
- 对于oracle直接一条sql 扣并 RETURNING 返回数据校验,超卖然后在回滚

## 扣库存优化思路和想法：

1. 直接把sql打印出来直接，用springjdbc模拟sql流程 测试哪一个sql 最耗时。
2. 减少和数据库的交互，能走缓存就走缓存。
3. 可以异步的日志，job或者消息操作。
4. 能放到事务外处理的，尽量移到外面。
5. 如果在一个大事务中添加每一步的耗时，是很不准确的，这样子事务开始的第一步会被拖耗很多时间。
6. 同一张库存表，根据不同字段更新同一数据会有引发死锁现象。所以更新纬度要统一用主键id